<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Battle Royale</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial; background:#000; }

/* MENU */
#menu {
  position:absolute;
  width:100%;
  height:100%;
  background:linear-gradient(#0f2027,#203a43,#2c5364);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  color:white;
  z-index:10;
}
.menu-btn {
  padding:15px 40px;
  margin:10px;
  font-size:20px;
  border:none;
  border-radius:10px;
  background:#e67e22;
  color:white;
}

/* CONFIG */
#config {
  display:none;
  flex-direction:column;
  align-items:center;
}
input { margin:10px; }

/* HUD */
#hud {
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  font-size:18px;
  display:none;
}
#lifeBar {
  width:200px;
  height:20px;
  background:#555;
  border-radius:10px;
  overflow:hidden;
}
#lifeFill {
  height:100%;
  width:100%;
  background:#e74c3c;
}

/* MIRA */
#crosshair {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:30px;
  color:white;
  display:none;
}

/* BOTÃ•ES */
button.gameBtn {
  position:absolute;
  width:80px;
  height:80px;
  border-radius:50%;
  border:none;
  opacity:0.7;
}
#shoot { bottom:30px; right:30px; background:red; }
#forward { bottom:130px; left:40px; background:#3498db; }
#back { bottom:30px; left:40px; background:#3498db; }
#left { bottom:80px; left:0px; background:#3498db; }
#right { bottom:80px; left:80px; background:#3498db; }
</style>
</head>
<body>

<div id="menu">
  <h1>Mini Battle Royale</h1>
  <button class="menu-btn" onclick="startGame()">JOGAR</button>
  <button class="menu-btn" onclick="openConfig()">CONFIGURAÃ‡Ã•ES</button>

  <div id="config">
    <label>Sensibilidade</label>
    <input type="range" id="sens" min="0.001" max="0.02" step="0.001" value="0.005">
    <label><input type="checkbox" id="showCross" checked> Mostrar Mira</label>
    <button class="menu-btn" onclick="saveConfig()">Salvar</button>
  </div>
</div>

<div id="hud">
  <div id="lifeBar"><div id="lifeFill"></div></div>
</div>

<div id="crosshair">+</div>

<button id="shoot" class="gameBtn"></button>
<button id="forward" class="gameBtn"></button>
<button id="back" class="gameBtn"></button>
<button id="left" class="gameBtn"></button>
<button id="right" class="gameBtn"></button>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>

let sensitivity = 0.005;

function openConfig(){
  document.getElementById("config").style.display="flex";
}

function saveConfig(){
  sensitivity = parseFloat(document.getElementById("sens").value);
  let cross = document.getElementById("showCross").checked;
  document.getElementById("crosshair").style.display = cross?"block":"none";
  alert("ConfiguraÃ§Ã£o salva!");
}

function startGame(){
  document.getElementById("menu").style.display="none";
  document.getElementById("hud").style.display="block";
  document.getElementById("crosshair").style.display="block";
}

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,5);
scene.add(light);

let floor = new THREE.Mesh(
  new THREE.PlaneGeometry(100,100),
  new THREE.MeshStandardMaterial({color:0x2ecc71})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

function createCharacter(color){
  let group = new THREE.Group();
  let material = new THREE.MeshStandardMaterial({color:color});
  let body = new THREE.Mesh(new THREE.BoxGeometry(1,1.5,0.5), material);
  body.position.y = 1.5;
  group.add(body);
  return group;
}

let player = createCharacter(0x3498db);
scene.add(player);

camera.position.set(0,4,6);

let life = 100;
let enemies = [];

for(let i=0;i<5;i++){
  let bot = createCharacter(0xe74c3c);
  bot.position.set(Math.random()*40-20,0,Math.random()*40-20);
  bot.life = 50;
  scene.add(bot);
  enemies.push(bot);
}

let move = {f:false,b:false,l:false,r:false};

function movePlayer(){
  let speed = 0.2;
  if(move.f) player.translateZ(-speed);
  if(move.b) player.translateZ(speed);
  if(move.l) player.rotation.y += 0.05;
  if(move.r) player.rotation.y -= 0.05;
}

forward.ontouchstart=()=>move.f=true;
forward.ontouchend=()=>move.f=false;
back.ontouchstart=()=>move.b=true;
back.ontouchend=()=>move.b=false;
left.ontouchstart=()=>move.l=true;
left.ontouchend=()=>move.l=false;
right.ontouchstart=()=>move.r=true;
right.ontouchend=()=>move.r=false;

shoot.onclick=function(){
  let bullet = new THREE.Mesh(
    new THREE.SphereGeometry(0.2),
    new THREE.MeshStandardMaterial({color:0xffff00})
  );
  bullet.position.copy(player.position);
  scene.add(bullet);

  let dir = new THREE.Vector3(0,0,-1);
  dir.applyQuaternion(player.quaternion);

  let interval = setInterval(()=>{
    bullet.position.add(dir.clone().multiplyScalar(0.5));

    enemies.forEach((bot,index)=>{
      if(bot.position.distanceTo(bullet.position)<1){
        bot.life-=25;
        if(bot.life<=0){
          scene.remove(bot);
          enemies.splice(index,1);
        }
      }
    });

    if(bullet.position.length()>200){
      scene.remove(bullet);
      clearInterval(interval);
    }

  },30);
}

let previousTouch;
renderer.domElement.addEventListener("touchmove",function(e){
  let touch = e.touches[0];
  if(previousTouch){
    let deltaX = touch.clientX - previousTouch.clientX;
    player.rotation.y -= deltaX * sensitivity;
  }
  previousTouch = touch;
});
renderer.domElement.addEventListener("touchend",()=>previousTouch=null);

function animate(){
  requestAnimationFrame(animate);

  movePlayer();

  camera.position.x = player.position.x + 6*Math.sin(player.rotation.y);
  camera.position.z = player.position.z + 6*Math.cos(player.rotation.y);
  camera.position.y = 4;
  camera.lookAt(player.position);

  enemies.forEach(bot=>{
    bot.lookAt(player.position);
    bot.translateZ(0.05);

    if(bot.position.distanceTo(player.position)<1.5){
      life -=0.3;
      document.getElementById("lifeFill").style.width = life+"%";
      if(life<=0){
        alert("VocÃª perdeu ðŸ˜¢");
        location.reload();
      }
    }
  });

  if(enemies.length==0){
    alert("VITÃ“RIA ðŸ”¥");
    location.reload();
  }

  renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
