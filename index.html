<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Battle Royale Mobile</title>
<style>
body { margin:0; overflow:hidden; background:#111; font-family:Arial; }
#ui {
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  font-size:18px;
}
button {
  position:absolute;
  width:80px;
  height:80px;
  border-radius:50%;
  border:none;
  opacity:0.7;
}
#shoot { bottom:30px; right:30px; background:red; }
#forward { bottom:130px; left:40px; background:#3498db; }
#back { bottom:30px; left:40px; background:#3498db; }
#left { bottom:80px; left:0px; background:#3498db; }
#right { bottom:80px; left:80px; background:#3498db; }
</style>
</head>
<body>

<div id="ui">Vida: 100</div>

<button id="shoot"></button>
<button id="forward"></button>
<button id="back"></button>
<button id="left"></button>
<button id="right"></button>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// LUZ
let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,5);
scene.add(light);

// CH√ÉO
let floor = new THREE.Mesh(
  new THREE.PlaneGeometry(100,100),
  new THREE.MeshStandardMaterial({color:0x2ecc71})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// FUN√á√ÉO PARA CRIAR BONECO
function createCharacter(color){
  let group = new THREE.Group();

  let material = new THREE.MeshStandardMaterial({color:color});

  let body = new THREE.Mesh(new THREE.BoxGeometry(1,1.5,0.5), material);
  body.position.y = 1.5;
  group.add(body);

  let head = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.8,0.8), material);
  head.position.y = 2.6;
  group.add(head);

  let arm1 = new THREE.Mesh(new THREE.BoxGeometry(0.3,1,0.3), material);
  arm1.position.set(-0.8,1.5,0);
  group.add(arm1);

  let arm2 = arm1.clone();
  arm2.position.x = 0.8;
  group.add(arm2);

  let leg1 = new THREE.Mesh(new THREE.BoxGeometry(0.4,1,0.4), material);
  leg1.position.set(-0.3,0.5,0);
  group.add(leg1);

  let leg2 = leg1.clone();
  leg2.position.x = 0.3;
  group.add(leg2);

  return group;
}

// PLAYER
let player = createCharacter(0x3498db);
scene.add(player);
player.position.y = 0;

camera.position.set(0,4,6);

// VIDA
let life = 100;

// INIMIGOS
let enemies = [];
for(let i=0;i<5;i++){
  let bot = createCharacter(0xe74c3c);
  bot.position.set(Math.random()*40-20,0,Math.random()*40-20);
  bot.life = 50;
  scene.add(bot);
  enemies.push(bot);
}

// MOVIMENTO
let move = {f:false,b:false,l:false,r:false};

function movePlayer(){
  let speed = 0.2;
  if(move.f) player.translateZ(-speed);
  if(move.b) player.translateZ(speed);
  if(move.l) player.rotation.y += 0.05;
  if(move.r) player.rotation.y -= 0.05;
}

// BOT√ïES
forward.ontouchstart=()=>move.f=true;
forward.ontouchend=()=>move.f=false;

back.ontouchstart=()=>move.b=true;
back.ontouchend=()=>move.b=false;

left.ontouchstart=()=>move.l=true;
left.ontouchend=()=>move.l=false;

right.ontouchstart=()=>move.r=true;
right.ontouchend=()=>move.r=false;

// TIRO
shoot.onclick=function(){
  let bullet = new THREE.Mesh(
    new THREE.SphereGeometry(0.2),
    new THREE.MeshStandardMaterial({color:0xffff00})
  );
  bullet.position.copy(player.position);
  scene.add(bullet);

  let dir = new THREE.Vector3(0,0,-1);
  dir.applyQuaternion(player.quaternion);

  let interval = setInterval(()=>{
    bullet.position.add(dir.clone().multiplyScalar(0.5));

    enemies.forEach((bot,index)=>{
      if(bot.position.distanceTo(bullet.position)<1){
        bot.life-=25;
        if(bot.life<=0){
          scene.remove(bot);
          enemies.splice(index,1);
        }
      }
    });

    if(bullet.position.length()>200){
      scene.remove(bullet);
      clearInterval(interval);
    }

  },30);
}

// C√ÇMERA ARRASTANDO
let previousTouch;
renderer.domElement.addEventListener("touchmove",function(e){
  let touch = e.touches[0];
  if(previousTouch){
    let deltaX = touch.clientX - previousTouch.clientX;
    player.rotation.y -= deltaX * 0.005;
  }
  previousTouch = touch;
});
renderer.domElement.addEventListener("touchend",()=>previousTouch=null);

// ANIMA√á√ÉO
function animate(){
  requestAnimationFrame(animate);

  movePlayer();

  camera.position.x = player.position.x + 6*Math.sin(player.rotation.y);
  camera.position.z = player.position.z + 6*Math.cos(player.rotation.y);
  camera.position.y = 4;
  camera.lookAt(player.position);

  enemies.forEach(bot=>{
    bot.lookAt(player.position);
    bot.translateZ(0.05);

    if(bot.position.distanceTo(player.position)<1.5){
      life -=0.3;
      document.getElementById("ui").innerText="Vida: "+Math.floor(life);
      if(life<=0){
        alert("Voc√™ perdeu üò¢");
        location.reload();
      }
    }
  });

  if(enemies.length==0){
    alert("VIT√ìRIA üî•");
    location.reload();
  }

  renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
